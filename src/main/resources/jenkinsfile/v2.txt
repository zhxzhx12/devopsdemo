pipeline {

  agent any
  // def gradleHome

    environment {
        gradleHome = script{tool 'mylocalGradle'}
   }

    stages {

      stage('Checkout Git') {
            steps {
              git 'https://github.com/zhxzhx12/devopsdemo.git'
            }
      }

      stage('Build') {
          steps {
            script {
              if (isUnix()) {
                sh "'${gradleHome}/bin/gradle' clean build -x test"
              } else {
                // bat(/"${mvnHome}\bin\mvn" -Dmaven.test.failure.ignore clean package/)
              }
            }
          }
      }

      stage('Test and Run Docker') {
          steps {
            sh "'${gradleHome}/bin/gradle' test "
          }

          post{
            always{
                echo "alway post below steps"
            }
            failure{
                echo "got some test error"
            }
          }
      }

      stage("Build Docker"){
        	steps{
        		echo "build docker"
        	}
      }

    }

    post {
        always {
          dir("build/test-results/test"){
            junit 'TEST-*.xml'
          }
        }
        failure {
            //mail to: team@example.com, subject: 'The Pipeline failed :('
            echo "got some test error"
        }
      }

}
